<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Constituency methodology - PolicyEngine UK data</title><meta property="og:title" content="Constituency methodology - PolicyEngine UK data"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><meta name="image" content="/policyengine-uk-data/build/nomis_screenshot1-9564622aa17f6683cd4182d79cd16b4c.png"/><meta property="og:image" content="/policyengine-uk-data/build/nomis_screenshot1-9564622aa17f6683cd4182d79cd16b4c.png"/><link rel="stylesheet" href="/policyengine-uk-data/build/_assets/app-KKSZXL3E.css"/><link rel="stylesheet" href="/policyengine-uk-data/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/policyengine-uk-data/favicon.ico"/><link rel="stylesheet" href="/policyengine-uk-data/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/policyengine-uk-data/"><div class="myst-home-link-logo p-1 mr-3 dark:bg-white dark:rounded"><img src="/policyengine-uk-data/build/logo-37a251ac9ba26b0d3940d6fb52dbde76.png" class="h-9" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="PolicyEngine UK data" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/policyengine-uk-data/">PolicyEngine UK data</a><a title="Methodology" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/policyengine-uk-data/methodology">Methodology</a><a title="Imputations" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/policyengine-uk-data/imputations">Imputations</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Validation" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow" href="/policyengine-uk-data/validation">Validation</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><a title="Pension contributions" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/policyengine-uk-data/pension-contributions">Pension contributions</a><a title="Constituency methodology" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/policyengine-uk-data/constituency-methodology">Constituency methodology</a><a title="Local authority methodology" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/policyengine-uk-data/la-methodology">Local authority methodology</a></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/policyengine/policyengine-uk-data" title="GitHub Repository: policyengine/policyengine-uk-data" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/policyengine/policyengine-uk-data/edit/main/docs/constituency_methodology.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Constituency methodology</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">PolicyEngine Team</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="m0Au3Zf4h8" class="myst-jp-nb-block relative group/block"><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>When policy changes in the UK - taxes, benefits, or public spending - it affects places and people differently. PolicyEngine UK builds tools to analyze incomes, jobs, and population patterns in each constituency. This documentation explains how we create a microsimulation model that works at the constituency level. The system combines workplace surveys of jobs and earnings, HMRC tax records, and population statistics. We map data between 2010 and 2024 constituency boundaries, estimate income distributions, and optimize geographic weights.</p><p>This guide shows how to use PolicyEngine UK for constituency analysis. We start with data collection, transform it for modeling, and build tools to examine policies. The guide provides examples and code to implement these methods. Users can measure changes in household budgets, track employment, and understand economic patterns on different constituencies. This document starts with data collection from workplace surveys, tax records, and population counts, then explains how we convert this data into usable forms through income brackets and boundary mapping. It concludes with technical details about accuracy measurement and calibration, plus example code for analysis and visualization.</p></div><div id="buZovbYoGL" class="myst-jp-nb-block relative group/block"><h2 id="data" class="relative group"><span class="heading-text">Data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this section, we describe three main data sources that form the foundation of our constituency-level analysis: earning and jobs data from NOMIS ASHE, income statistics from HMRC, and population age distributions from the House of Commons Library.</p><h3 id="earning-and-jobs-data" class="relative group"><span class="heading-text">Earning and jobs data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#earning-and-jobs-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Data is extracted from NOMIS Annual Survey of Hours and Earnings (ASHE) - workplace analysis dataset, containing number of jobs and earnings percentiles for all UK parliamentary constituencies from the <a target="_blank" rel="noreferrer" href="https://www.nomisweb.co.uk/datasets/ashe" class="">NOMIS website</a>. This dataset is stored as <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/nomis_earning_jobs_data.xlsx" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>nomis_earning_jobs_data.xlsx</code></a>. To download the data, follow the variable selection process shown in the image below:</p><img id="AyMXdGEQD0" style="margin:0 auto" src="/policyengine-uk-data/build/nomis_screenshot1-9564622aa17f6683cd4182d79cd16b4c.png" data-canonical-url="pictures/nomis_screenshot1.png" class=""/></div><div id="HvfkPnsMqQ" class="myst-jp-nb-block relative group/block"><h3 id="income-data" class="relative group"><span class="heading-text">Income data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#income-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Income data for UK parliamentary constituencies is obtained from <a target="_blank" rel="noreferrer" href="https://www.gov.uk/government/statistics/income-and-tax-by-parliamentary-constituency-confidence-intervals" class="">HMRC</a>. This dataset provides detailed information about income and tax by Parliamentary constituency with confidence intervals, and is stored as <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>total_income.csv</code></a>, including two key variables:</p><ul><li><p><a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv#L1" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>total_income_count</code></a>: the total number of taxpayers in each constituency</p></li><li><p><a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv#L1" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>total_income_amount</code></a>: the total amount of income for all taxpayers in each constituency</p></li></ul><p>We use these measures to identify similar constituencies when employment distribution data is missing. Our approach assumes that constituencies with similar income patterns (measured by both taxpayer counts and total income) will have similar earnings distributions. The following table shows the dataset:</p></div><div id="kAAtGtxeR1" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pandas as pd
from itables import init_notebook_mode, show
import itables.options as opt
opt.maxBytes = &quot;1MB&quot;
init_notebook_mode(all_interactive=True)

pd.read_csv(&quot;../policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="9mPPLHVMNjcz8miDC9dyj" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="ttx1TXkMOI" class="myst-jp-nb-block relative group/block"><h3 id="population-data-by-age" class="relative group"><span class="heading-text">Population data by age</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#population-data-by-age" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Population data by age groups for UK parliamentary constituencies can be downloaded from the <a target="_blank" rel="noreferrer" href="https://commonslibrary.parliament.uk/constituency-statistics-population-by-age/" class="">House of Commons Library data dashboard</a>. The dataset provides detailed age breakdowns for each UK constituency, containing population counts for every age from 0 to 90+ years old across all parliamentary constituencies in England, Wales, Northern Ireland, and Scotland. The data is stored as <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>age.csv</code></a>. The following table shows the dataset:</p></div><div id="aWD2vgZFC7" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pandas as pd
from itables import init_notebook_mode, show
import itables.options as opt
opt.maxBytes = &quot;1MB&quot;
init_notebook_mode(all_interactive=True)

pd.read_csv(&quot;../policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="aSRL8P-iWsk3ShuxVf_KD" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="VV3do6UvjH" class="myst-jp-nb-block relative group/block"><h2 id="preprocessing" class="relative group"><span class="heading-text">Preprocessing</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#preprocessing" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this section, we detail two key preprocessing steps necessary for our constituency-level analysis: converting earnings percentiles into practical income brackets, and mapping between different constituency boundary definitions (2010 to 2024).</p><h3 id="convert-earning-percentiles-to-brackets" class="relative group"><span class="heading-text">Convert earning percentiles to brackets</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#convert-earning-percentiles-to-brackets" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>To analyze earnings data effectively, we convert earning percentiles into earning brackets through the following process:</p><ol start="1"><li><p>First, we estimate the full distribution of earnings by:</p><ul><li><p>Using known percentile data (10th to 90th) from the ASHE dataset</p></li><li><p>Extending this to estimate the 90th-99th percentiles using ratios derived from <a target="_blank" rel="noreferrer" href="https://www.gov.uk/government/statistics/percentile-points-from-1-to-99-for-total-income-before-and-after-tax#:~:text=Details,in%20the%20Background%20Quality%20Report" class="">this government statistics report</a></p></li></ul></li><li><p>This estimation allows us to map earnings data into brackets that align with policy thresholds.</p></li></ol><p>The following code and visualization demonstrate this process using an example constituency:</p></div><div id="IPweiPZXoP" class="myst-jp-nb-block relative group/block"><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Sample data for Darlington
income_data = {
    &#x27;parliamentary constituency 2010&#x27;: [&#x27;Darlington&#x27;],
    &#x27;constituency_code&#x27;: [&#x27;E14000658&#x27;],
    &#x27;Number of jobs&#x27;: [&#x27;31000&#x27;],
    &#x27;10 percentile&#x27;: [13298.0],
    &#x27;20 percentile&#x27;: [16723.0],
    &#x27;30 percentile&#x27;: [20778.0],
    &#x27;40 percentile&#x27;: [23407.0],
    &#x27;50 percentile&#x27;: [27158.0],
    &#x27;60 percentile&#x27;: [30471.0],
    &#x27;70 percentile&#x27;: [33812.0],
    &#x27;80 percentile&#x27;: [40717.0],
    &#x27;90 percentile&#x27;: [55762.0],
    &#x27;91 percentile&#x27;: [58878.0],
    &#x27;92 percentile&#x27;: [62394.4],
    &#x27;93 percentile&#x27;: [66722.3],
    &#x27;94 percentile&#x27;: [71952.0],
    &#x27;95 percentile&#x27;: [78804.5],
    &#x27;96 percentile&#x27;: [87640.7],
    &#x27;97 percentile&#x27;: [100083.5],
    &#x27;98 percentile&#x27;: [123526.5],
    &#x27;100 percentile&#x27;: [179429.0]
}

income_sample = pd.DataFrame(income_data)

# Excel Data Method
def load_real_data():
    # Read Excel data
    income_real = pd.read_excel(&quot;nomis_earning_jobs_data.xlsx&quot;, skiprows=7)
    income_real.columns = income_real.iloc[0]
    income_real = income_real.drop(index=0).reset_index(drop=True)
    
    # Select and rename columns
    columns_to_keep = [
        &#x27;parliamentary constituency 2010&#x27;,
        &#x27;constituency_code&#x27;,
        &#x27;Number of jobs&#x27;,
        &#x27;Median&#x27;,
        &#x27;10 percentile&#x27;,
        &#x27;20 percentile&#x27;,
        &#x27;30 percentile&#x27;,
        &#x27;40 percentile&#x27;,
        &#x27;60 percentile&#x27;,
        &#x27;70 percentile&#x27;,
        &#x27;80 percentile&#x27;,
        &#x27;90 percentile&#x27;
    ]
    income_real = income_real[columns_to_keep]
    income_real = income_real.rename(columns={&#x27;Median&#x27;: &#x27;50 percentile&#x27;})
    return income_real

# Plotting function
def plot_constituency_distribution(income_df, constituency_name, detailed=True):
    constituency_data = income_df[income_df[&#x27;parliamentary constituency 2010&#x27;] == constituency_name].iloc[0]
    
    percentiles = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 91, 92, 93, 94, 95, 96, 97, 98, 100]
    income_values = [
        0,
        constituency_data[&#x27;10 percentile&#x27;],
        constituency_data[&#x27;20 percentile&#x27;],
        constituency_data[&#x27;30 percentile&#x27;],
        constituency_data[&#x27;40 percentile&#x27;],
        constituency_data[&#x27;50 percentile&#x27;],
        constituency_data[&#x27;60 percentile&#x27;],
        constituency_data[&#x27;70 percentile&#x27;],
        constituency_data[&#x27;80 percentile&#x27;],
        constituency_data[&#x27;90 percentile&#x27;],
        constituency_data[&#x27;91 percentile&#x27;],
        constituency_data[&#x27;92 percentile&#x27;],
        constituency_data[&#x27;93 percentile&#x27;],
        constituency_data[&#x27;94 percentile&#x27;],
        constituency_data[&#x27;95 percentile&#x27;],
        constituency_data[&#x27;96 percentile&#x27;],
        constituency_data[&#x27;97 percentile&#x27;],
        constituency_data[&#x27;98 percentile&#x27;],
        constituency_data[&#x27;100 percentile&#x27;]
    ]
    
    valid_data = [(p, v) for p, v in zip(percentiles, income_values) if pd.notna(v)]
    filtered_percentiles, filtered_income = zip(*valid_data)
    
    plt.figure(figsize=(8, 6))
    plt.plot(filtered_percentiles, filtered_income, marker=&#x27;o&#x27;)
    plt.xlabel(&#x27;Percentiles&#x27;)
    plt.ylabel(&#x27;Income&#x27;)
    plt.title(f&#x27;Income Distribution for {constituency_name}&#x27;)
    plt.grid(True)
    plt.show()

# Plot sample data (Darlington with detailed percentiles)
plot_constituency_distribution(income_sample, &#x27;Darlington&#x27;, detailed=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div><div id="IdeAQoLlSs" class="myst-jp-nb-block relative group/block"><img id="w73GaY96G6" style="margin:0 auto" src="/policyengine-uk-data/build/earning_dist-325ca612f6154036a337db91b4010823.png" data-canonical-url="pictures/earning_dist.png" class=""/><p>After estimating the full earnings distribution, we convert the data into income brackets. We calculate the number of jobs and total earnings for each constituency and income bracket based on the estimated earnings distribution. When we encounter constituencies with missing data, we estimate their earnings distribution pattern using data from constituencies with similar total number of taxpayers and total income levels.</p><p>The Python script <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/create_employment_incomes.py" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>create_employment_incomes.py</code></a> generates <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>employment_income.csv</code></a> containing number of jobs (<a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv#L1" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>employment_income_count</code></a>) and total earnings (<a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv#L1" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>employment_income_amount</code></a>) for each constituency and income bracket. The following table shows employment and income across different brackets for constituencies:</p></div><div id="SU2MCMnhci" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pandas as pd
from itables import init_notebook_mode, show
import itables.options as opt
opt.maxBytes = &quot;1MB&quot;
init_notebook_mode(all_interactive=True)

pd.read_csv(&quot;../policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Wtjou0QAzHFdYJQlWOrQD" class="myst-jp-output max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="Tjodg9Wt7T" class="myst-jp-nb-block relative group/block"><h3 id="mapping-constituencies-from-2010-to-2024" class="relative group"><span class="heading-text">Mapping constituencies from 2010 to 2024</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mapping-constituencies-from-2010-to-2024" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>PolicyEngine uses HMRC income data which aligns with 2010 constituency boundaries; to handle this issue and align it with 2024 constituency boundaries definitions, we follow these processes:</p><ol start="1"><li><p>Download the mapping data from the <a target="_blank" rel="noreferrer" href="https://www.data.gov.uk/dataset/20c4ffe5-7d86-419f-808e-da98e46f4f52/westminster-pcon-may-2010-to-westminster-pcon-july-2024-lookup-in-the-uk-v2" class="">ONS website</a> that contains the official lookup table between 2010 and 2024 Westminster Parliamentary Constituencies.</p></li><li><p>Create a mapping matrix (650 x 650) which maps each constituency from 2010 to corresponding constituency in 2024 using the <code>boundary_changes/mapping_matrix.py</code> script. This is a many-to-many mapping, as 2010 constituencies can be split across multiple 2024 constituencies, and 2024 constituencies can contain parts of multiple 2010 constituencies. The matrix structure has rows representing 2010 constituencies and columns representing 2024 constituencies.</p></li><li><p>For each row in the matrix (representing a 2010 constituency), normalize the weights so they sum to 1. This ensures that when we redistribute data from 2010 boundaries to 2024 boundaries, we maintain the correct proportions.</p></li></ol></div><div id="tfjAGlZ0vh" class="myst-jp-nb-block relative group/block"><h2 id="methodology" class="relative group"><span class="heading-text">Methodology</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#methodology" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This section describes our approach to creating accurate constituency-level estimates through three key components: a loss function for evaluating accuracy, a calibration process for optimizing weights, and the mathematical framework behind the optimization. To see how well this methodology performs in practice, you can check our detailed <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/docs/validation/constituencies.ipynb" class="italic" target="_blank" rel="noreferrer" data-state="closed">validation results page</a> comparing our estimates against actual data at both constituency and national levels.</p><h3 id="loss-function" class="relative group"><span class="heading-text">Loss function</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#loss-function" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The file <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>loss.py</code></a> defines a function <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L18" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>create_constituency_target_matrix</code></a> that creates target matrices for comparing simulated data against actual constituency-level data. The following process outlines how the function processes:</p><ol start="1"><li><p>Takes three main input parameters: dataset (defaults to <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L19" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>enhanced_frs_2022_23</code></a>), time_period (defaults to 2025), and an optional reform parameter for policy changes.</p></li><li><p>Reads three files containing real data: <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>age.csv</code></a>, <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>total_income.csv</code></a>, and <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>employment_income.csv</code></a>.</p></li><li><p>Creates a PolicyEngine Microsimulation object using the specified dataset and reform parameters.</p></li><li><p>Creates two main matrices: <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L33" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>matrix</code></a> for simulated values from PolicyEngine, and <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L34" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>y</code></a> for actual target values from both HMRC (income data) and ONS (age data).</p></li><li><p>Calculates total income metrics at the national level, computing both total amounts and counts of people with income.</p></li><li><p>Processes age distributions by creating 10-year age bands from 0 to 80, calculating how many people fall into each band.</p></li><li><p>Processes both counts and amounts for different income bands between £12,570 and £70,000, excluding people under 16 for employment income.</p></li><li><p>Maps individual-level results to household level throughout the <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L88" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>sim.map_result()</code></a> function.</p></li><li><p>The function returns both the simulated matrix and the target matrix <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L34" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>(matrix, y)</code></a> which can be used for comparing the simulation results against actual data.</p></li></ol></div><div id="qW2MLFKA0P" class="myst-jp-nb-block relative group/block"><h3 id="calibration-function" class="relative group"><span class="heading-text">Calibration function</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#calibration-function" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The file <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>calibrate.py</code></a> defines a main <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L25" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>calibrate()</code></a> function that performs weight calibration for constituency-level analysis.</p><ol start="1"><li><p>It imports necessary functions and matrices from other files including <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L16" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>create_constituency_target_matrix</code></a>, <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L17" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>create_national_target_matrix</code></a> from <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>loss.py</code></a>, and <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/transform_constituencies.py#L7" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>transform_2010_to_2024</code></a> for constituency boundary transformations.</p></li><li><p>Sets up initial matrices using the <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L26" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>create_constituency_target_matrix</code></a> and <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L28" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>create_national_target_matrix</code></a> functions for both constituency and national level data.</p></li><li><p>Creates a Microsimulation object using the <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L32" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>enhanced_frs_2022_23</code></a> dataset.</p></li><li><p>Initializes weights for 650 constituencies x 100180 households, starting with the log of household weights divided by constituency count.</p></li><li><p>Converts all the matrices and weights into PyTorch tensors to enable optimization.</p></li><li><p>Defines a loss function that calculates and combines both constituency-level and national-level mean squared errors into a single loss value.</p></li><li><p>Uses Adam optimizer with a learning rate of 0.1 to minimize the loss over 512 epochs.</p></li><li><p>Every 100 epochs during optimization, it updates the weights using the mapping matrix from 2010 to 2024 constituencies and saves the current weights to a <code>weights.h5</code> file.</p></li><li><p>Includes an <a href="https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L95" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>update_weights()</code></a> function that applies the constituency mapping matrix to transform the weights between different boundary definitions.</p></li></ol></div><div id="AG58r1f4zo" class="myst-jp-nb-block relative group/block"><h3 id="optimization-mathematics" class="relative group"><span class="heading-text">Optimization mathematics</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#optimization-mathematics" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>In this part, we explain the mathematics behind the calibration process that we discussed above. The optimization uses a two-part loss function that balances constituency-level and national-level accuracy, combining both local and national targets into a single optimization problem. The mathematical formulation can be expressed as follows:</p><p>For the constituency-level component, we have:</p><ul><li><p>A set of households (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>) with known characteristics (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>e</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>c</mi><msub><mi>s</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">metrics_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9456em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span>) like income, age, etc.</p></li><li><p>A set of constituencies (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></span>) with known target values (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">y_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>) from official statistics</p></li><li><p>Weights in log space (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span>) that we need to optimize for each household in each constituency</p></li></ul><p>Using these components, we calculate predicted constituency-level statistics. For each constituency metric (e.g. total income), the predicted value is:</p><div id="t5QaQjc3BV" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>pred</mtext><mi>c</mi></msub><mo>=</mo><munder><mo>∑</mo><mi>j</mi></munder><mo stretchy="false">(</mo><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mo>×</mo><msub><mtext>metrics</mtext><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{pred}_c = \sum_j (\exp(w_{ij}) \times \text{metrics}_j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"></span><span class="mord"><span class="mord text"><span class="mord">pred</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0573em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4638em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mop">exp</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord text"><span class="mord">metrics</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#t5QaQjc3BV" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->1<!-- -->)</a></div></div><p>where <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>metrics</mtext><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\text{metrics}_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.954em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord text"><span class="mord">metrics</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span> represents the household-level characteristics for that specific metric (e.g. household income). We use exponential of weights to ensure they stay positive.</p><p>To measure how well our predictions match the real constituency data, we calculate the constituency mean squared error:</p><div id="E6HZOETzdV" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>MSE</mtext><mi>c</mi></msub><mo>=</mo><mtext>mean</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><msub><mtext>pred</mtext><mi>c</mi></msub><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>y</mi><mi>c</mi></msub><mo stretchy="false">)</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{MSE}_c = \text{mean}((\text{pred}_c / (1 + y_c) - 1)^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">MSE</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">mean</span></span><span class="mopen">((</span><span class="mord"><span class="mord text"><span class="mord">pred</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0573em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#E6HZOETzdV" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->2<!-- -->)</a></div></div><p>where <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">y_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> are the actual target values from official statistics for each constituency. We use relative error (dividing by <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><msub><mi>y</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">1 + y_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>) to make errors comparable across different scales of metrics.</p><p>For the national component, we need to ensure our constituency-level adjustments don’t distort national-level statistics. We aggregate across all constituencies:</p><div id="Sz1xriutSC" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>pred</mtext><mi>n</mi></msub><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><mo stretchy="false">(</mo><munder><mo>∑</mo><mi>j</mi></munder><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>×</mo><msub><mtext>metrics</mtext><mtext>national</mtext></msub></mrow><annotation encoding="application/x-tex">\text{pred}_n = \sum_i (\sum_j \exp(w_{ij})) \times \text{metrics}_\text{national}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9386em;vertical-align:-0.2441em;"></span><span class="mord"><span class="mord text"><span class="mord">pred</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0573em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4638em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">exp</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8179em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">metrics</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">national</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#Sz1xriutSC" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->3<!-- -->)</a></div></div><p>with corresponding mean squared error to measure deviation from national targets:</p><div id="cPhWSud5K6" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>MSE</mtext><mi>n</mi></msub><mo>=</mo><mtext>mean</mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><msub><mtext>pred</mtext><mi>n</mi></msub><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{MSE}_n = \text{mean}((\text{pred}_n / (1 + y_n) - 1)^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">MSE</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">mean</span></span><span class="mopen">((</span><span class="mord"><span class="mord text"><span class="mord">pred</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0573em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#cPhWSud5K6" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->4<!-- -->)</a></div></div><p>The total loss combines both constituency and national errors:</p><div id="hZJ4p10DEy" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo>=</mo><msub><mtext>MSE</mtext><mi>c</mi></msub><mo>+</mo><msub><mtext>MSE</mtext><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">L = \text{MSE}_c + \text{MSE}_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">MSE</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">MSE</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#hZJ4p10DEy" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->5<!-- -->)</a></div></div><p>We initialize the weights using the original household weights from the survey data:</p><div id="rmIlQg5wwS" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mtext>initial</mtext></msub><mo>=</mo><mi>ln</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mtext>household</mtext><mrow><mi>w</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mi mathvariant="normal">/</mi><mn>650</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">w_{\text{initial}} = \ln(\text{household}_{weight}/650)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">initial</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mop">ln</span><span class="mopen">(</span><span class="mord"><span class="mord text"><span class="mord">household</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord">/650</span><span class="mclose">)</span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#rmIlQg5wwS" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->6<!-- -->)</a></div></div><p>where 650 is the number of constituencies. These weights are then iteratively optimized using the Adam (Adaptive Moment Estimation) optimizer with a learning rate of 0.1. The optimization process runs for 512 epochs, with the weights being updated in each iteration:</p><div id="FFkFWcrj82" class="flex my-5 group"><div class="flex-grow overflow-x-auto overflow-y-hidden"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>w</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>w</mi><mi>t</mi></msub><mo>−</mo><mn>0.1</mn><mo>×</mo><mi mathvariant="normal">∇</mi><mi>L</mi><mo stretchy="false">(</mo><msub><mi>w</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">w_{t+1} = w_t - 0.1 \times \nabla L(w_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0.1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∇</span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div><div class="relative self-center flex-none pl-2 m-0 text-right select-none"><a class="no-underline text-inherit hover:text-inherit text-inherit hover:text-inherit select-none hover:underline" href="#FFkFWcrj82" title="Link to this Equation" aria-label="Link to this Equation">(<!-- -->7<!-- -->)</a></div></div><p>This formulation ensures that the optimized weights maintain both local consistency at the constituency level and global accuracy for national-level statistics. The Adam optimizer adaptively adjusts the weights to minimize both constituency-level and national-level errors simultaneously, providing efficient convergence through adaptive learning rates and momentum. The resulting optimized weights allow us to accurately reweight household survey data to match both constituency-level and national statistics to obtain accurate estimates of income distributions, demographics, and policy impacts for each parliamentary constituency while maintaining consistency with national totals.</p></div><div id="M2SCShnXnO" class="myst-jp-nb-block relative group/block"></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/policyengine-uk-data/pension-contributions"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">PolicyEngine UK data</div>Pension contributions</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/policyengine-uk-data/la-methodology"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">PolicyEngine UK data</div>Local authority methodology</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let d=Math.random().toString(32).slice(2);window.history.replaceState({key:d},"")}try{let u=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof u=="number"&&window.scrollTo(0,u)}catch(d){console.error(d),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/policyengine-uk-data/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-UGO2RSJF.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-HHKX4TLX.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-YATQFWLS.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-MBMQ6BQC.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-CVDX4WR7.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-NK7RXO5Q.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/root-TRTRBUUN.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-6NUWI4AQ.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/_shared/chunk-M5KN76GI.js"/><link rel="modulepreload" href="/policyengine-uk-data/build/routes/$-VLPGWU3Z.js"/><script>window.__remixContext = {"url":"/constituency-methodology","state":{"loaderData":{"root":{"config":{"version":2,"myst":"1.6.7","options":{"logo":"/policyengine-uk-data/build/logo-37a251ac9ba26b0d3940d6fb52dbde76.png","folders":true},"nav":[],"actions":[],"projects":[{"title":"PolicyEngine UK data","authors":[{"nameParsed":{"given":"PolicyEngine","family":"Team","literal":"PolicyEngine Team"},"name":"PolicyEngine Team","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-uk-data","copyright":"2024","toc":[{"file":"intro.md"},{"file":"methodology.ipynb"},{"file":"imputations.md"},{"children":[{"file":"validation/national.ipynb"},{"file":"validation/constituencies.ipynb"},{"file":"validation/local_authorities.ipynb"}],"file":"validation/index.md"},{"file":"pension_contributions.ipynb"},{"file":"constituency_methodology.ipynb"},{"file":"LA_methodology.ipynb"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"methodology","title":"Methodology","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"imputations","title":"Imputations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"validation.index","title":"Validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"validation.national","title":"National dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"validation.constituencies","title":"Constituency dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"validation.local-authorities","title":"Local authority dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pension-contributions","title":"Pension contributions","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"constituency-methodology","title":"Constituency methodology","description":"","date":"","thumbnail":"/policyengine-uk-data/build/nomis_screenshot1-9564622aa17f6683cd4182d79cd16b4c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"la-methodology","title":"Local authority methodology","description":"","date":"","thumbnail":"/policyengine-uk-data/build/nomis_screenshot2-87ccebeb16251bd114856327df9b29f7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/policyengine-uk-data"},"routes/$":{"config":{"version":2,"myst":"1.6.7","options":{"logo":"/policyengine-uk-data/build/logo-37a251ac9ba26b0d3940d6fb52dbde76.png","folders":true},"nav":[],"actions":[],"projects":[{"title":"PolicyEngine UK data","authors":[{"nameParsed":{"given":"PolicyEngine","family":"Team","literal":"PolicyEngine Team"},"name":"PolicyEngine Team","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-uk-data","copyright":"2024","toc":[{"file":"intro.md"},{"file":"methodology.ipynb"},{"file":"imputations.md"},{"children":[{"file":"validation/national.ipynb"},{"file":"validation/constituencies.ipynb"},{"file":"validation/local_authorities.ipynb"}],"file":"validation/index.md"},{"file":"pension_contributions.ipynb"},{"file":"constituency_methodology.ipynb"},{"file":"LA_methodology.ipynb"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"methodology","title":"Methodology","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"imputations","title":"Imputations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"validation.index","title":"Validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"validation.national","title":"National dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"validation.constituencies","title":"Constituency dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"validation.local-authorities","title":"Local authority dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pension-contributions","title":"Pension contributions","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"constituency-methodology","title":"Constituency methodology","description":"","date":"","thumbnail":"/policyengine-uk-data/build/nomis_screenshot1-9564622aa17f6683cd4182d79cd16b4c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"la-methodology","title":"Local authority methodology","description":"","date":"","thumbnail":"/policyengine-uk-data/build/nomis_screenshot2-87ccebeb16251bd114856327df9b29f7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}]},"page":{"version":2,"kind":"Notebook","sha256":"4858eda65b75476210e5abdbacff996ceb86b961ac5cb048e8a53e7ccd540418","slug":"constituency-methodology","location":"/constituency_methodology.ipynb","dependencies":[],"frontmatter":{"title":"Constituency methodology","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"base","language":"python"},"authors":[{"nameParsed":{"given":"PolicyEngine","family":"Team","literal":"PolicyEngine Team"},"name":"PolicyEngine Team","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-uk-data","copyright":"2024","source_url":"https://github.com/policyengine/policyengine-uk-data/blob/main/docs/constituency_methodology.ipynb","edit_url":"https://github.com/policyengine/policyengine-uk-data/edit/main/docs/constituency_methodology.ipynb","thumbnail":"/policyengine-uk-data/build/nomis_screenshot1-9564622aa17f6683cd4182d79cd16b4c.png","exports":[{"format":"ipynb","filename":"constituency_methodology.ipynb","url":"/policyengine-uk-data/build/constituency_methodo-1cce8bd5c2b4d1f5992ab7941731662d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aqM92hNT3L"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"qoDevA0sKe"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"When policy changes in the UK - taxes, benefits, or public spending - it affects places and people differently. PolicyEngine UK builds tools to analyze incomes, jobs, and population patterns in each constituency. This documentation explains how we create a microsimulation model that works at the constituency level. The system combines workplace surveys of jobs and earnings, HMRC tax records, and population statistics. We map data between 2010 and 2024 constituency boundaries, estimate income distributions, and optimize geographic weights.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"F5g6hKGMss"}],"key":"zSOkmUVtYn"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This guide shows how to use PolicyEngine UK for constituency analysis. We start with data collection, transform it for modeling, and build tools to examine policies. The guide provides examples and code to implement these methods. Users can measure changes in household budgets, track employment, and understand economic patterns on different constituencies. This document starts with data collection from workplace surveys, tax records, and population counts, then explains how we convert this data into usable forms through income brackets and boundary mapping. It concludes with technical details about accuracy measurement and calibration, plus example code for analysis and visualization.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Dklipmz6xg"}],"key":"tOWxnp6wD0"}],"key":"m0Au3Zf4h8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xPKDxMuHXg"}],"identifier":"data","label":"Data","html_id":"data","implicit":true,"key":"FE3lBEV0iS"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this section, we describe three main data sources that form the foundation of our constituency-level analysis: earning and jobs data from NOMIS ASHE, income statistics from HMRC, and population age distributions from the House of Commons Library.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ybzlDACuoF"}],"key":"iUBxwpZlGo"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Earning and jobs data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mu5WsKrWQ7"}],"identifier":"earning-and-jobs-data","label":"Earning and jobs data","html_id":"earning-and-jobs-data","implicit":true,"key":"i5lDZ5AkY7"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Data is extracted from NOMIS Annual Survey of Hours and Earnings (ASHE) - workplace analysis dataset, containing number of jobs and earnings percentiles for all UK parliamentary constituencies from the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"LeZe2QQoiH"},{"type":"link","url":"https://www.nomisweb.co.uk/datasets/ashe","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"NOMIS website","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"h5CfAfrkCC"}],"urlSource":"https://www.nomisweb.co.uk/datasets/ashe","key":"Jvw0zUXtvm"},{"type":"text","value":". This dataset is stored as ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BxAIDxbCHC"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/nomis_earning_jobs_data.xlsx","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"nomis_earning_jobs_data.xlsx","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"g9GNXeInji"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/nomis_earning_jobs_data.xlsx","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/nomis_earning_jobs_data.xlsx","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/nomis_earning_jobs_data.xlsx"},"internal":false,"protocol":"github","key":"gDOIM16Jmz"},{"type":"text","value":". To download the data, follow the variable selection process shown in the image below:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PRAReiUDMM"}],"key":"MjxX7Nl9uE"},{"type":"image","url":"/policyengine-uk-data/build/nomis_screenshot1-9564622aa17f6683cd4182d79cd16b4c.png","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"AyMXdGEQD0","urlSource":"pictures/nomis_screenshot1.png"}],"key":"buZovbYoGL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Income data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EL94gu1ckB"}],"identifier":"income-data","label":"Income data","html_id":"income-data","implicit":true,"key":"yGpLi9MfHM"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Income data for UK parliamentary constituencies is obtained from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z6c9h6bF3N"},{"type":"link","url":"https://www.gov.uk/government/statistics/income-and-tax-by-parliamentary-constituency-confidence-intervals","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"HMRC","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JROZTPNU5N"}],"urlSource":"https://www.gov.uk/government/statistics/income-and-tax-by-parliamentary-constituency-confidence-intervals","key":"F9KJfHh1QT"},{"type":"text","value":". This dataset provides detailed information about income and tax by Parliamentary constituency with confidence intervals, and is stored as ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mAr6ZAtPLq"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"total_income.csv","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NNnOUsgdAU"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv"},"internal":false,"protocol":"github","key":"yToYHfqqEc"},{"type":"text","value":", including two key variables:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zKfa6pDFOw"}],"key":"dJ8wcOEOng"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv#L1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"total_income_count","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vvmGHOfxzy"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv#L1","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv","from":1,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv"},"internal":false,"protocol":"github","key":"Z9bDsQtkfV"},{"type":"text","value":": the total number of taxpayers in each constituency","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YfGCRrn0Xo"}],"key":"gUXjGlw83t"}],"key":"chbfsZaNCO"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv#L1","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"total_income_amount","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Ky5ixwegxA"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv#L1","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv","from":1,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv"},"internal":false,"protocol":"github","key":"JFjUkQISjm"},{"type":"text","value":": the total amount of income for all taxpayers in each constituency","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"z2N4QfQwZE"}],"key":"eZpkQ2mDCU"}],"key":"z9RadjtjK1"}],"key":"JHslr8mF9t"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"We use these measures to identify similar constituencies when employment distribution data is missing. Our approach assumes that constituencies with similar income patterns (measured by both taxpayer counts and total income) will have similar earnings distributions. The following table shows the dataset:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"TQEdprB5Jv"}],"key":"p8Zp48xjSj"}],"key":"HvfkPnsMqQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nfrom itables import init_notebook_mode, show\nimport itables.options as opt\nopt.maxBytes = \"1MB\"\ninit_notebook_mode(all_interactive=True)\n\npd.read_csv(\"../policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv\")","key":"PTxKAKcJ6X"},{"type":"output","id":"9mPPLHVMNjcz8miDC9dyj","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003cscript\u003e\n    let is_dark_theme = function () {\n        // Jupyter Lab\n        if ('jpThemeLight' in document.body.dataset)\n            return (document.body.dataset.jpThemeLight === \"false\");\n\n        // VS Code\n        if ('vscodeThemeKind' in document.body.dataset)\n            return document.body.dataset.vscodeThemeKind.includes('dark');\n\n        // Jupyter Book\n        if ('theme' in document.documentElement.dataset)\n            return document.documentElement.dataset.theme.includes('dark');\n\n        // Default\n        return window.matchMedia('(prefers-color-scheme: dark)').matches;\n    }\n\n    if (is_dark_theme()) {\n        document.documentElement.classList.add('dark');\n    }\n    else {\n        document.documentElement.classList.remove('dark');\n    }\n\u003c/script\u003e\n","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"c6ab3fbdab1ff94600e51c14dfe3f701","path":"/policyengine-uk-data/build/c6ab3fbdab1ff94600e51c14dfe3f701.html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"dfb915152674e94c00e70433737d2dfa","path":"/policyengine-uk-data/build/dfb915152674e94c00e70433737d2dfa.html"},"text/plain":{"content":"          code                       name  total_income_count  \\\n0    E14000530                  Aldershot             56000.0   \n1    E14000531        Aldridge-Brownhills             40000.0   \n2    E14000532   Altrincham and Sale West             53000.0   \n3    E14000533               Amber Valley             46000.0   \n4    E14000534    Arundel and South Downs             56000.0   \n..         ...                        ...                 ...   \n645  W07000076                 Caerphilly             38000.0   \n646  W07000077                     Islwyn             34000.0   \n647  W07000078          Vale of Glamorgan             51000.0   \n648  W07000079               Cardiff West             45000.0   \n649  W07000080  Cardiff South and Penarth             50000.0   \n\n     total_income_amount  \n0           1.999200e+09  \n1           1.312000e+09  \n2           3.180000e+09  \n3           1.389200e+09  \n4           2.665600e+09  \n..                   ...  \n645         1.193200e+09  \n646         9.656000e+08  \n647         1.810500e+09  \n648         1.647000e+09  \n649         1.640000e+09  \n\n[650 rows x 4 columns]","content_type":"text/plain"}}}],"key":"vYen3CH8gx"}],"key":"kAAtGtxeR1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Population data by age","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RwFdc76a3w"}],"identifier":"population-data-by-age","label":"Population data by age","html_id":"population-data-by-age","implicit":true,"key":"igeODWQHLY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Population data by age groups for UK parliamentary constituencies can be downloaded from the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KgFggLS3Re"},{"type":"link","url":"https://commonslibrary.parliament.uk/constituency-statistics-population-by-age/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"House of Commons Library data dashboard","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QgtfVZmsvZ"}],"urlSource":"https://commonslibrary.parliament.uk/constituency-statistics-population-by-age/","key":"nVuwxTYgg4"},{"type":"text","value":". The dataset provides detailed age breakdowns for each UK constituency, containing population counts for every age from 0 to 90+ years old across all parliamentary constituencies in England, Wales, Northern Ireland, and Scotland. The data is stored as ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tipJiTsxNL"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"age.csv","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mdEYC6lA81"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv"},"internal":false,"protocol":"github","key":"otSfc1GidR"},{"type":"text","value":". The following table shows the dataset:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nbfVO7w0AP"}],"key":"jCLuLGV94l"}],"key":"ttx1TXkMOI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nfrom itables import init_notebook_mode, show\nimport itables.options as opt\nopt.maxBytes = \"1MB\"\ninit_notebook_mode(all_interactive=True)\n\npd.read_csv(\"../policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv\")","key":"CwLLYHhJYa"},{"type":"output","id":"aSRL8P-iWsk3ShuxVf_KD","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003cscript\u003e\n    let is_dark_theme = function () {\n        // Jupyter Lab\n        if ('jpThemeLight' in document.body.dataset)\n            return (document.body.dataset.jpThemeLight === \"false\");\n\n        // VS Code\n        if ('vscodeThemeKind' in document.body.dataset)\n            return document.body.dataset.vscodeThemeKind.includes('dark');\n\n        // Jupyter Book\n        if ('theme' in document.documentElement.dataset)\n            return document.documentElement.dataset.theme.includes('dark');\n\n        // Default\n        return window.matchMedia('(prefers-color-scheme: dark)').matches;\n    }\n\n    if (is_dark_theme()) {\n        document.documentElement.classList.add('dark');\n    }\n    else {\n        document.documentElement.classList.remove('dark');\n    }\n\u003c/script\u003e\n","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"c6ab3fbdab1ff94600e51c14dfe3f701","path":"/policyengine-uk-data/build/c6ab3fbdab1ff94600e51c14dfe3f701.html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"execute_result","execution_count":21,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"126dd4d9d2b312a8e2f92a04a8d3aeaa","path":"/policyengine-uk-data/build/126dd4d9d2b312a8e2f92a04a8d3aeaa.html"},"text/plain":{"content":"          code                       name       all       0       1       2  \\\n0    E14000530                  Aldershot  105168.0  1313.0  1401.0  1436.0   \n1    E14000531        Aldridge-Brownhills   77683.0   783.0   789.0   840.0   \n2    E14000532   Altrincham and Sale West  102444.0   943.0  1058.0  1130.0   \n3    E14000533               Amber Valley   92277.0   815.0   902.0   932.0   \n4    E14000534    Arundel and South Downs  102673.0   789.0   779.0   903.0   \n..         ...                        ...       ...     ...     ...     ...   \n645  W07000076                 Caerphilly   88586.0   886.0   906.0   979.0   \n646  W07000077                     Islwyn   76917.0   689.0   732.0   838.0   \n647  W07000078          Vale of Glamorgan  105094.0   976.0  1050.0  1165.0   \n648  W07000079               Cardiff West   94951.0  1116.0  1111.0  1132.0   \n649  W07000080  Cardiff South and Penarth  118913.0  1282.0  1277.0  1392.0   \n\n          3       4       5       6  ...     81     82     83     84     85  \\\n0    1294.0  1347.0  1491.0  1323.0  ...  513.0  455.0  449.0  362.0  317.0   \n1     784.0   822.0   908.0   897.0  ...  634.0  638.0  568.0  461.0  412.0   \n2    1198.0  1390.0  1287.0  1416.0  ...  610.0  557.0  511.0  455.0  436.0   \n3    1008.0   957.0   964.0   939.0  ...  562.0  515.0  466.0  409.0  350.0   \n4     938.0   984.0  1097.0  1052.0  ...  916.0  892.0  737.0  690.0  590.0   \n..      ...     ...     ...     ...  ...    ...    ...    ...    ...    ...   \n645  1029.0  1099.0  1053.0  1070.0  ...  491.0  477.0  387.0  363.0  334.0   \n646   789.0   836.0   872.0   852.0  ...  463.0  405.0  351.0  338.0  312.0   \n647  1261.0  1192.0  1271.0  1217.0  ...  656.0  592.0  531.0  447.0  389.0   \n648  1165.0  1236.0  1274.0  1284.0  ...  436.0  422.0  353.0  359.0  273.0   \n649  1406.0  1571.0  1511.0  1489.0  ...  516.0  513.0  405.0  421.0  355.0   \n\n        86     87     88     89     90+  \n0    322.0  230.0  186.0  179.0   802.0  \n1    348.0  333.0  319.0  253.0   922.0  \n2    376.0  346.0  311.0  292.0  1252.0  \n3    327.0  318.0  237.0  191.0   897.0  \n4    552.0  496.0  436.0  427.0  1562.0  \n..     ...    ...    ...    ...     ...  \n645  314.0  247.0  200.0  200.0   548.0  \n646  304.0  200.0  201.0  161.0   606.0  \n647  390.0  325.0  275.0  247.0   870.0  \n648  294.0  250.0  218.0  178.0   695.0  \n649  345.0  294.0  289.0  227.0   923.0  \n\n[650 rows x 94 columns]","content_type":"text/plain"}}}],"key":"wTmu25Ooou"}],"key":"aWD2vgZFC7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Preprocessing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qzduqAMFVL"}],"identifier":"preprocessing","label":"Preprocessing","html_id":"preprocessing","implicit":true,"key":"WYw2eTi5rI"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this section, we detail two key preprocessing steps necessary for our constituency-level analysis: converting earnings percentiles into practical income brackets, and mapping between different constituency boundary definitions (2010 to 2024).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"o7MgiHLBXR"}],"key":"aPZbzfy5b7"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Convert earning percentiles to brackets","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"c5uRlLIzn4"}],"identifier":"convert-earning-percentiles-to-brackets","label":"Convert earning percentiles to brackets","html_id":"convert-earning-percentiles-to-brackets","implicit":true,"key":"ykRsDOaMf9"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"To analyze earnings data effectively, we convert earning percentiles into earning brackets through the following process:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"aRPwlCN8IJ"}],"key":"rK21lh6awW"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"First, we estimate the full distribution of earnings by:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"QECVObFITS"}],"key":"z9y9MzPXiA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Using known percentile data (10th to 90th) from the ASHE dataset","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"NMfsdxUwWV"}],"key":"AO6Gk4LGQK"}],"key":"tx4tdkeysx"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Extending this to estimate the 90th-99th percentiles using ratios derived from ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"P3VjDDjcsd"},{"type":"link","url":"https://www.gov.uk/government/statistics/percentile-points-from-1-to-99-for-total-income-before-and-after-tax#:~:text=Details,in%20the%20Background%20Quality%20Report","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"this government statistics report","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ieDiWXrQwe"}],"urlSource":"https://www.gov.uk/government/statistics/percentile-points-from-1-to-99-for-total-income-before-and-after-tax#:~:text=Details,in%20the%20Background%20Quality%20Report","key":"YUFHhYp8Dc"}],"key":"HUoV2dp692"}],"key":"Qs88uVCPft"}],"key":"goVSZpCiLr"}],"key":"ACQc92VWx8"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"This estimation allows us to map earnings data into brackets that align with policy thresholds.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"gkdLRXEptt"}],"key":"LEj8J1ZfGX"}],"key":"EPHGE6Rd9t"}],"key":"t5Saf1g4gq"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"The following code and visualization demonstrate this process using an example constituency:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Om8XJa2CyG"}],"key":"iXxrSWoyjy"}],"key":"VV3do6UvjH"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# Sample data for Darlington\nincome_data = {\n    'parliamentary constituency 2010': ['Darlington'],\n    'constituency_code': ['E14000658'],\n    'Number of jobs': ['31000'],\n    '10 percentile': [13298.0],\n    '20 percentile': [16723.0],\n    '30 percentile': [20778.0],\n    '40 percentile': [23407.0],\n    '50 percentile': [27158.0],\n    '60 percentile': [30471.0],\n    '70 percentile': [33812.0],\n    '80 percentile': [40717.0],\n    '90 percentile': [55762.0],\n    '91 percentile': [58878.0],\n    '92 percentile': [62394.4],\n    '93 percentile': [66722.3],\n    '94 percentile': [71952.0],\n    '95 percentile': [78804.5],\n    '96 percentile': [87640.7],\n    '97 percentile': [100083.5],\n    '98 percentile': [123526.5],\n    '100 percentile': [179429.0]\n}\n\nincome_sample = pd.DataFrame(income_data)\n\n# Excel Data Method\ndef load_real_data():\n    # Read Excel data\n    income_real = pd.read_excel(\"nomis_earning_jobs_data.xlsx\", skiprows=7)\n    income_real.columns = income_real.iloc[0]\n    income_real = income_real.drop(index=0).reset_index(drop=True)\n    \n    # Select and rename columns\n    columns_to_keep = [\n        'parliamentary constituency 2010',\n        'constituency_code',\n        'Number of jobs',\n        'Median',\n        '10 percentile',\n        '20 percentile',\n        '30 percentile',\n        '40 percentile',\n        '60 percentile',\n        '70 percentile',\n        '80 percentile',\n        '90 percentile'\n    ]\n    income_real = income_real[columns_to_keep]\n    income_real = income_real.rename(columns={'Median': '50 percentile'})\n    return income_real\n\n# Plotting function\ndef plot_constituency_distribution(income_df, constituency_name, detailed=True):\n    constituency_data = income_df[income_df['parliamentary constituency 2010'] == constituency_name].iloc[0]\n    \n    percentiles = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 91, 92, 93, 94, 95, 96, 97, 98, 100]\n    income_values = [\n        0,\n        constituency_data['10 percentile'],\n        constituency_data['20 percentile'],\n        constituency_data['30 percentile'],\n        constituency_data['40 percentile'],\n        constituency_data['50 percentile'],\n        constituency_data['60 percentile'],\n        constituency_data['70 percentile'],\n        constituency_data['80 percentile'],\n        constituency_data['90 percentile'],\n        constituency_data['91 percentile'],\n        constituency_data['92 percentile'],\n        constituency_data['93 percentile'],\n        constituency_data['94 percentile'],\n        constituency_data['95 percentile'],\n        constituency_data['96 percentile'],\n        constituency_data['97 percentile'],\n        constituency_data['98 percentile'],\n        constituency_data['100 percentile']\n    ]\n    \n    valid_data = [(p, v) for p, v in zip(percentiles, income_values) if pd.notna(v)]\n    filtered_percentiles, filtered_income = zip(*valid_data)\n    \n    plt.figure(figsize=(8, 6))\n    plt.plot(filtered_percentiles, filtered_income, marker='o')\n    plt.xlabel('Percentiles')\n    plt.ylabel('Income')\n    plt.title(f'Income Distribution for {constituency_name}')\n    plt.grid(True)\n    plt.show()\n\n# Plot sample data (Darlington with detailed percentiles)\nplot_constituency_distribution(income_sample, 'Darlington', detailed=True)","key":"kArTxp1yNz"}],"key":"IPweiPZXoP"},{"type":"block","kind":"notebook-content","children":[{"type":"image","url":"/policyengine-uk-data/build/earning_dist-325ca612f6154036a337db91b4010823.png","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w73GaY96G6","urlSource":"pictures/earning_dist.png"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"After estimating the full earnings distribution, we convert the data into income brackets. We calculate the number of jobs and total earnings for each constituency and income bracket based on the estimated earnings distribution. When we encounter constituencies with missing data, we estimate their earnings distribution pattern using data from constituencies with similar total number of taxpayers and total income levels.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gLNaJaLirZ"}],"key":"Y08WeZHC3c"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The Python script ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wTMFtHtGdz"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/create_employment_incomes.py","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"create_employment_incomes.py","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JrJ6SgTu0w"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/create_employment_incomes.py","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/create_employment_incomes.py","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/create_employment_incomes.py"},"internal":false,"protocol":"github","key":"xJmoGxdwbw"},{"type":"text","value":" generates ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fWxo1p5ufW"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"employment_income.csv","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"EGC7FJphh2"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv"},"internal":false,"protocol":"github","key":"fzqsPAtZNF"},{"type":"text","value":" containing number of jobs (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"M3beEXaBoZ"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv#L1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"employment_income_count","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"edEM8DchHD"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv#L1","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv","from":1,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv"},"internal":false,"protocol":"github","key":"XGyTD6WsoK"},{"type":"text","value":") and total earnings (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"j9rJxivFX4"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv#L1","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"employment_income_amount","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"B7xDrPof7i"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv#L1","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv","from":1,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv"},"internal":false,"protocol":"github","key":"g9wmsye9Mg"},{"type":"text","value":") for each constituency and income bracket. The following table shows employment and income across different brackets for constituencies:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qTG58wo1Yb"}],"key":"C7mKXSD4Uz"}],"key":"IdeAQoLlSs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pandas as pd\nfrom itables import init_notebook_mode, show\nimport itables.options as opt\nopt.maxBytes = \"1MB\"\ninit_notebook_mode(all_interactive=True)\n\npd.read_csv(\"../policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv\")","key":"mi9qUg5QIh"},{"type":"output","id":"Wtjou0QAzHFdYJQlWOrQD","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003cscript\u003e\n    let is_dark_theme = function () {\n        // Jupyter Lab\n        if ('jpThemeLight' in document.body.dataset)\n            return (document.body.dataset.jpThemeLight === \"false\");\n\n        // VS Code\n        if ('vscodeThemeKind' in document.body.dataset)\n            return document.body.dataset.vscodeThemeKind.includes('dark');\n\n        // Jupyter Book\n        if ('theme' in document.documentElement.dataset)\n            return document.documentElement.dataset.theme.includes('dark');\n\n        // Default\n        return window.matchMedia('(prefers-color-scheme: dark)').matches;\n    }\n\n    if (is_dark_theme()) {\n        document.documentElement.classList.add('dark');\n    }\n    else {\n        document.documentElement.classList.remove('dark');\n    }\n\u003c/script\u003e\n","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"c6ab3fbdab1ff94600e51c14dfe3f701","path":"/policyengine-uk-data/build/c6ab3fbdab1ff94600e51c14dfe3f701.html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"84217562928d92bca843d25e74fdbc99","path":"/policyengine-uk-data/build/84217562928d92bca843d25e74fdbc99.html"},"text/plain":{"content":"           code                       name  employment_income_lower_bound  \\\n0     E14000530                  Aldershot                         200000   \n1     E14000530                  Aldershot                         500000   \n2     E14000530                  Aldershot                         300000   \n3     E14000530                  Aldershot                              0   \n4     E14000530                  Aldershot                          12570   \n...         ...                        ...                            ...   \n8445  W07000080  Cardiff South and Penarth                         100000   \n8446  W07000080  Cardiff South and Penarth                         150000   \n8447  W07000080  Cardiff South and Penarth                         200000   \n8448  W07000080  Cardiff South and Penarth                              0   \n8449  W07000080  Cardiff South and Penarth                         500000   \n\n      employment_income_upper_bound  employment_income_count  \\\n0                          300000.0               660.099464   \n1                               inf                 0.000000   \n2                          500000.0                 0.000000   \n3                           12570.0              1073.632697   \n4                           15000.0               623.501391   \n...                             ...                      ...   \n8445                       150000.0              2510.857214   \n8446                       200000.0              1920.943459   \n8447                       300000.0                 0.000000   \n8448                        12570.0               700.837422   \n8449                            inf                 0.000000   \n\n      employment_income_amount  \n0                 1.650249e+08  \n1                 0.000000e+00  \n2                 0.000000e+00  \n3                 6.747782e+06  \n4                 8.594967e+06  \n...                        ...  \n8445              3.138572e+08  \n8446              3.361651e+08  \n8447              0.000000e+00  \n8448              4.404763e+06  \n8449              0.000000e+00  \n\n[8450 rows x 6 columns]","content_type":"text/plain"}}}],"key":"zVlI4ozTGJ"}],"key":"SU2MCMnhci"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mapping constituencies from 2010 to 2024","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LtwIgOJP8j"}],"identifier":"mapping-constituencies-from-2010-to-2024","label":"Mapping constituencies from 2010 to 2024","html_id":"mapping-constituencies-from-2010-to-2024","implicit":true,"key":"f7ocP7118T"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"PolicyEngine uses HMRC income data which aligns with 2010 constituency boundaries; to handle this issue and align it with 2024 constituency boundaries definitions, we follow these processes:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TBv6cVt4w4"}],"key":"yZcyBTxS3s"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Download the mapping data from the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ypWGmytyn3"},{"type":"link","url":"https://www.data.gov.uk/dataset/20c4ffe5-7d86-419f-808e-da98e46f4f52/westminster-pcon-may-2010-to-westminster-pcon-july-2024-lookup-in-the-uk-v2","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"ONS website","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wlMrUk74OO"}],"urlSource":"https://www.data.gov.uk/dataset/20c4ffe5-7d86-419f-808e-da98e46f4f52/westminster-pcon-may-2010-to-westminster-pcon-july-2024-lookup-in-the-uk-v2","key":"buMISaUyx4"},{"type":"text","value":" that contains the official lookup table between 2010 and 2024 Westminster Parliamentary Constituencies.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rJZaYcJYtQ"}],"key":"H053DYsA19"}],"key":"MbGmpxBOF8"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Create a mapping matrix (650 x 650) which maps each constituency from 2010 to corresponding constituency in 2024 using the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GhSQWzrl9h"},{"type":"inlineCode","value":"boundary_changes/mapping_matrix.py","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IIoG7xE853"},{"type":"text","value":" script. This is a many-to-many mapping, as 2010 constituencies can be split across multiple 2024 constituencies, and 2024 constituencies can contain parts of multiple 2010 constituencies. The matrix structure has rows representing 2010 constituencies and columns representing 2024 constituencies.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"t9GyShQVEv"}],"key":"vao4ssAD3R"}],"key":"SJdgwlB2i0"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"For each row in the matrix (representing a 2010 constituency), normalize the weights so they sum to 1. This ensures that when we redistribute data from 2010 boundaries to 2024 boundaries, we maintain the correct proportions.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"NkNCkbX9rF"}],"key":"pbAedpp8Su"}],"key":"RVSiEkMgu8"}],"key":"PBj5KXCpWk"}],"key":"Tjodg9Wt7T"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Methodology","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ng21e4Cxy6"}],"identifier":"methodology","label":"Methodology","html_id":"methodology","implicit":true,"key":"o8LOuZ4ZFZ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This section describes our approach to creating accurate constituency-level estimates through three key components: a loss function for evaluating accuracy, a calibration process for optimizing weights, and the mathematical framework behind the optimization. To see how well this methodology performs in practice, you can check our detailed ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u9etWf7k2J"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/docs/validation/constituencies.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"validation results page","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yDxXlQhKbp"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/docs/validation/constituencies.ipynb","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"docs/validation/constituencies.ipynb","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/docs/validation/constituencies.ipynb"},"internal":false,"protocol":"github","key":"zZcdvxe2h1"},{"type":"text","value":" comparing our estimates against actual data at both constituency and national levels.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gBcb2k72Cw"}],"key":"ARkoun2hMv"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Loss function","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"s1TCBJWjZW"}],"identifier":"loss-function","label":"Loss function","html_id":"loss-function","implicit":true,"key":"YTGL36rm7w"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The file ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KomYaF1F3v"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"loss.py","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jJgpZfMPgH"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py"},"internal":false,"protocol":"github","key":"hikCCRbYit"},{"type":"text","value":" defines a function ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ru73eT66Ut"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L18","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"create_constituency_target_matrix","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"yuG7cjvAIn"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L18","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","from":18,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py"},"internal":false,"protocol":"github","key":"QXW3casGUc"},{"type":"text","value":" that creates target matrices for comparing simulated data against actual constituency-level data. The following process outlines how the function processes:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dYvRSGNo3s"}],"key":"UjIBxYPlsc"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Takes three main input parameters: dataset (defaults to ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ZLcMnVS6E1"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L19","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"enhanced_frs_2022_23","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"okXwYGHwRV"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L19","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","from":19,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py"},"internal":false,"protocol":"github","key":"ZwD4FAp95R"},{"type":"text","value":"), time_period (defaults to 2025), and an optional reform parameter for policy changes.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Z6WotpDKMw"}],"key":"Nlt0zVMAXB"}],"key":"ZI1XVtTMak"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Reads three files containing real data: ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"s7xgCW1ZlD"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"age.csv","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"TWCebIbiXh"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/age.csv"},"internal":false,"protocol":"github","key":"jFz7733akB"},{"type":"text","value":", ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"J9FHU21cUq"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"total_income.csv","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"E2h8OelFRK"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/total_income.csv"},"internal":false,"protocol":"github","key":"PAfE75W5NT"},{"type":"text","value":", and ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qKOOXWfZU0"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"inlineCode","value":"employment_income.csv","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"WVFuR56b0m"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/targets/employment_income.csv"},"internal":false,"protocol":"github","key":"v0GqKNwtXx"},{"type":"text","value":".","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"RitQrgGkNQ"}],"key":"D8RvP4xpsA"}],"key":"KcsjkDJJZ9"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Creates a PolicyEngine Microsimulation object using the specified dataset and reform parameters.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"IzzMHX6hYt"}],"key":"qZDTVOLw7R"}],"key":"ICN24zcQ8p"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Creates two main matrices: ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"GMtoqAPDFD"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L33","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"inlineCode","value":"matrix","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"k93ERj5W9U"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L33","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","from":33,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py"},"internal":false,"protocol":"github","key":"je6xZuxwwf"},{"type":"text","value":" for simulated values from PolicyEngine, and ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"JV8DXi5abW"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L34","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"inlineCode","value":"y","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"YDX6WoSECv"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L34","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","from":34,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py"},"internal":false,"protocol":"github","key":"kLDxlLcBVR"},{"type":"text","value":" for actual target values from both HMRC (income data) and ONS (age data).","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"i3pOyK0Nmz"}],"key":"Z4yzL2ROVp"}],"key":"GymMrzczrr"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Calculates total income metrics at the national level, computing both total amounts and counts of people with income.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"dFyZ5r51qH"}],"key":"Z1QmufWSNc"}],"key":"jXYH90g3fb"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Processes age distributions by creating 10-year age bands from 0 to 80, calculating how many people fall into each band.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"qzq57SwBgJ"}],"key":"im750QdozG"}],"key":"Qi8YdjqfKD"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Processes both counts and amounts for different income bands between £12,570 and £70,000, excluding people under 16 for employment income.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"qFppuVWxRk"}],"key":"a5fLjE3dY5"}],"key":"hd3HWv4jMO"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Maps individual-level results to household level throughout the ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Yes4hnkqLl"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L88","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"inlineCode","value":"sim.map_result()","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"oXmPJ8MPgP"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L88","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","from":88,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py"},"internal":false,"protocol":"github","key":"ZgdElQt0gH"},{"type":"text","value":" function.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"mXjESRpCM6"}],"key":"Ob6sOy8idc"}],"key":"n2LMCwPQL4"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"The function returns both the simulated matrix and the target matrix ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"NvbgUi31Q4"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L34","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"inlineCode","value":"(matrix, y)","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"smJe5THcGW"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py#L34","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","from":34,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py"},"internal":false,"protocol":"github","key":"gjPOd5FOP6"},{"type":"text","value":" which can be used for comparing the simulation results against actual data.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"dbkZGV0B6n"}],"key":"vfuZjKnGFN"}],"key":"SRuJzcuPRS"}],"key":"dUVjhSFJo4"}],"key":"tfjAGlZ0vh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calibration function","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oPyF4vXyy1"}],"identifier":"calibration-function","label":"Calibration function","html_id":"calibration-function","implicit":true,"key":"DXTdI0Wxbf"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The file ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"N8cE6tUCwm"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"calibrate.py","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lxH2MjpOhS"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py"},"internal":false,"protocol":"github","key":"C4syiEJqkt"},{"type":"text","value":" defines a main ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GiFxeBVm74"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L25","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"calibrate()","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QaPoR63WRr"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L25","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","from":25,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py"},"internal":false,"protocol":"github","key":"CCFSZphnRg"},{"type":"text","value":" function that performs weight calibration for constituency-level analysis.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eh7X7yqwqr"}],"key":"Sg0Ibf2UEp"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"It imports necessary functions and matrices from other files including ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uBEc34T717"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L16","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"create_constituency_target_matrix","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"k9QyaeqCjF"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L16","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","from":16,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py"},"internal":false,"protocol":"github","key":"EqqniwYoQ0"},{"type":"text","value":", ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UTNignaSGB"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L17","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"create_national_target_matrix","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QuvO2arcUa"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L17","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","from":17,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py"},"internal":false,"protocol":"github","key":"JoF0Mgz6TI"},{"type":"text","value":" from ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SkRMu6BCzA"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"loss.py","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZvU3qK0FV6"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py","raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/loss.py"},"internal":false,"protocol":"github","key":"cRhTYvnIuQ"},{"type":"text","value":", and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Aqf7gIVo2K"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/transform_constituencies.py#L7","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"inlineCode","value":"transform_2010_to_2024","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UNg7ZlylEy"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/transform_constituencies.py#L7","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/transform_constituencies.py","from":7,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/transform_constituencies.py"},"internal":false,"protocol":"github","key":"Tzo63X6zJg"},{"type":"text","value":" for constituency boundary transformations.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zswUXU1BuQ"}],"key":"CyAtp15U8j"}],"key":"AXfQNYerxD"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Sets up initial matrices using the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"tcqNb7oinb"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L26","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"create_constituency_target_matrix","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"buKX4luHPb"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L26","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","from":26,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py"},"internal":false,"protocol":"github","key":"JHErOWQ6R3"},{"type":"text","value":" and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"cSWNcgKCqh"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L28","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineCode","value":"create_national_target_matrix","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"NS4RpORNU6"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L28","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","from":28,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py"},"internal":false,"protocol":"github","key":"VnEefW3T9T"},{"type":"text","value":" functions for both constituency and national level data.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"f49K9WqUBn"}],"key":"tQI1TpT7o3"}],"key":"uzJI6mSTAU"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Creates a Microsimulation object using the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"CKOtpUCldy"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L32","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"enhanced_frs_2022_23","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"E9BCDkCw66"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L32","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","from":32,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py"},"internal":false,"protocol":"github","key":"ZyviFevA9k"},{"type":"text","value":" dataset.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"hkBDBaVD4A"}],"key":"E1KeiQbco5"}],"key":"aB7A5T8rND"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Initializes weights for 650 constituencies x 100180 households, starting with the log of household weights divided by constituency count.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"t7YMsuu92x"}],"key":"zssc0AyeOT"}],"key":"QLCori9UKF"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Converts all the matrices and weights into PyTorch tensors to enable optimization.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"qnACyH62QT"}],"key":"OHtWw9mH5v"}],"key":"tEbtUZIzwu"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Defines a loss function that calculates and combines both constituency-level and national-level mean squared errors into a single loss value.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BwUM2G6ZQ9"}],"key":"iWnYKqBjUb"}],"key":"hmMnqirpEW"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Uses Adam optimizer with a learning rate of 0.1 to minimize the loss over 512 epochs.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"YJ7Sk62ou1"}],"key":"BOMwJhoRkb"}],"key":"rxYMOvpNgi"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Every 100 epochs during optimization, it updates the weights using the mapping matrix from 2010 to 2024 constituencies and saves the current weights to a ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"OZSqQSdvn5"},{"type":"inlineCode","value":"weights.h5","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"dNkxRW5giE"},{"type":"text","value":" file.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"s8dYMExRXx"}],"key":"geRUCxfSr2"}],"key":"o0gkj3yZnG"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Includes an ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"UFde0XFk7B"},{"type":"link","url":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L95","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"inlineCode","value":"update_weights()","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"JAPbQ9mibs"}],"urlSource":"https://github.com/PolicyEngine/policyengine-uk-data/blob/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py#L95","data":{"kind":"file","org":"PolicyEngine","repo":"policyengine-uk-data","reference":"7c782c4839a024c729350a3ff2c76922bf21b0d4","file":"policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py","from":95,"raw":"https://raw.githubusercontent.com/PolicyEngine/policyengine-uk-data/7c782c4839a024c729350a3ff2c76922bf21b0d4/policyengine_uk_data/datasets/frs/local_areas/constituencies/calibrate.py"},"internal":false,"protocol":"github","key":"rDMNjswDHU"},{"type":"text","value":" function that applies the constituency mapping matrix to transform the weights between different boundary definitions.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"usvHCG1sbm"}],"key":"ayjD6u839H"}],"key":"w0npAtqnu7"}],"key":"xeefJ9fRG4"}],"key":"qW2MLFKA0P"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optimization mathematics","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T7mhzlS4Ij"}],"identifier":"optimization-mathematics","label":"Optimization mathematics","html_id":"optimization-mathematics","implicit":true,"key":"U9jcRrkqx6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this part, we explain the mathematics behind the calibration process that we discussed above. The optimization uses a two-part loss function that balances constituency-level and national-level accuracy, combining both local and national targets into a single optimization problem. The mathematical formulation can be expressed as follows:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Spyv2CP3eO"}],"key":"IySzCXLNb5"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For the constituency-level component, we have:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Jl4BtE4QEf"}],"key":"tPNy4jBFal"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A set of households (","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"jM4QmB9z3G"},{"type":"inlineMath","value":"j","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ej\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"K1oziNlXGe"},{"type":"text","value":") with known characteristics (","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Qgm4nStevP"},{"type":"inlineMath","value":"metrics_j","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmsub\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003emetrics_j\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.9456em;vertical-align:-0.2861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ee\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ei\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ec\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003es\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"xCFxb1ILqE"},{"type":"text","value":") like income, age, etc.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OSSeFoxfgj"}],"key":"fgrZsyKuU1"}],"key":"Du0sqZvun0"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A set of constituencies (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jYILilqDZV"},{"type":"inlineMath","value":"i","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ei\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6595em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"Zbu21j12Z8"},{"type":"text","value":") with known target values (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FVQkiulYTT"},{"type":"inlineMath","value":"y_c","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ey_c\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"rePoC7KxMC"},{"type":"text","value":") from official statistics","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"niyFcgvEDi"}],"key":"ppIdVXogLi"}],"key":"b3ucp0HZib"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Weights in log space (","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"BdYtqsYqV1"},{"type":"inlineMath","value":"w_{ij}","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ew_{ij}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"fNtdFNZZM0"},{"type":"text","value":") that we need to optimize for each household in each constituency","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"u6MMA0cGQR"}],"key":"CJkt0A5qPT"}],"key":"pmF0Upz1mf"}],"key":"H6BkGLmbjb"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Using these components, we calculate predicted constituency-level statistics. For each constituency metric (e.g. total income), the predicted value is:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"SI7v0EmM7n"}],"key":"SjerAZMwVg"},{"type":"math","value":"\\text{pred}_c = \\sum_j (\\exp(w_{ij}) \\times \\text{metrics}_j)","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmtext\u003epred\u003c/mtext\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/munder\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eexp\u003c/mi\u003e\u003cmo\u003e⁡\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmsub\u003e\u003cmtext\u003emetrics\u003c/mtext\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\text{pred}_c = \\sum_j (\\exp(w_{ij}) \\times \\text{metrics}_j)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.9386em;vertical-align:-0.2441em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003epred\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.0573em;\"\u003e\u003cspan style=\"top:-2.4559em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2441em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.4638em;vertical-align:-1.4138em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop op-limits\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.05em;\"\u003e\u003cspan style=\"top:-1.8723em;margin-left:0em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.05em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.05em;\"\u003e\u003c/span\u003e\u003cspan\u003e\u003cspan class=\"mop op-symbol large-op\"\u003e∑\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.4138em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mop\"\u003eexp\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003emetrics\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"1","key":"t5QaQjc3BV"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"oiq3SovCdc"},{"type":"inlineMath","value":"\\text{metrics}_j","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmtext\u003emetrics\u003c/mtext\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\text{metrics}_j\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.954em;vertical-align:-0.2861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003emetrics\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"PXGJjisC2Z"},{"type":"text","value":" represents the household-level characteristics for that specific metric (e.g. household income). We use exponential of weights to ensure they stay positive.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"DV5Mp0C8tp"}],"key":"L3ubqzYCWd"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"To measure how well our predictions match the real constituency data, we calculate the constituency mean squared error:","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"YmQEMEbdU7"}],"key":"LYNpbhP9lS"},{"type":"math","value":"\\text{MSE}_c = \\text{mean}((\\text{pred}_c / (1 + y_c) - 1)^2)","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmtext\u003eMSE\u003c/mtext\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmtext\u003emean\u003c/mtext\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmtext\u003epred\u003c/mtext\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003cmi mathvariant=\"normal\"\u003e/\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\text{MSE}_c = \\text{mean}((\\text{pred}_c / (1 + y_c) - 1)^2)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eMSE\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003emean\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e((\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003epred\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.0573em;\"\u003e\u003cspan style=\"top:-2.4559em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2441em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e/\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.1141em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose\"\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8641em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"2","key":"E6HZOETzdV"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"wXdsP2LcJQ"},{"type":"inlineMath","value":"y_c","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ey_c\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"lvSFpS1xdb"},{"type":"text","value":" are the actual target values from official statistics for each constituency. We use relative error (dividing by ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"wdayM23G0Y"},{"type":"inlineMath","value":"1 + y_c","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e1 + y_c\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"s2AfHOEq5Y"},{"type":"text","value":") to make errors comparable across different scales of metrics.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"el48Agm2it"}],"key":"zwKhEEcoCu"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"For the national component, we need to ensure our constituency-level adjustments don’t distort national-level statistics. We aggregate across all constituencies:","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"GL7jqmiWrX"}],"key":"RjyipuqMII"},{"type":"math","value":"\\text{pred}_n = \\sum_i (\\sum_j \\exp(w_{ij})) \\times \\text{metrics}_\\text{national}","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmtext\u003epred\u003c/mtext\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/munder\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmunder\u003e\u003cmo\u003e∑\u003c/mo\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/munder\u003e\u003cmi\u003eexp\u003c/mi\u003e\u003cmo\u003e⁡\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003ej\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmsub\u003e\u003cmtext\u003emetrics\u003c/mtext\u003e\u003cmtext\u003enational\u003c/mtext\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\text{pred}_n = \\sum_i (\\sum_j \\exp(w_{ij})) \\times \\text{metrics}_\\text{national}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.9386em;vertical-align:-0.2441em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003epred\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.0573em;\"\u003e\u003cspan style=\"top:-2.4559em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2441em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.4638em;vertical-align:-1.4138em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop op-limits\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.05em;\"\u003e\u003cspan style=\"top:-1.8723em;margin-left:0em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.05em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.05em;\"\u003e\u003c/span\u003e\u003cspan\u003e\u003cspan class=\"mop op-symbol large-op\"\u003e∑\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.2777em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mop op-limits\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.05em;\"\u003e\u003cspan style=\"top:-1.8723em;margin-left:0em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.05em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003ej\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.05em;\"\u003e\u003c/span\u003e\u003cspan\u003e\u003cspan class=\"mop op-symbol large-op\"\u003e∑\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.4138em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop\"\u003eexp\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3117em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\"\u003eij\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e))\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8179em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003emetrics\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord text mtight\"\u003e\u003cspan class=\"mord mtight\"\u003enational\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"3","key":"Sz1xriutSC"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"with corresponding mean squared error to measure deviation from national targets:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"CM8uF2BgbC"}],"key":"weCniheSII"},{"type":"math","value":"\\text{MSE}_n = \\text{mean}((\\text{pred}_n / (1 + y_n) - 1)^2)","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmtext\u003eMSE\u003c/mtext\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmtext\u003emean\u003c/mtext\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmtext\u003epred\u003c/mtext\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmi mathvariant=\"normal\"\u003e/\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\text{MSE}_n = \\text{mean}((\\text{pred}_n / (1 + y_n) - 1)^2)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eMSE\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003emean\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e((\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003epred\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.0573em;\"\u003e\u003cspan style=\"top:-2.4559em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2441em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e/\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.1141em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose\"\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8641em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"4","key":"cPhWSud5K6"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"The total loss combines both constituency and national errors:","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"uX9G4jv2qO"}],"key":"fyfPtqC6Rk"},{"type":"math","value":"L = \\text{MSE}_c + \\text{MSE}_n","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eL\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmtext\u003eMSE\u003c/mtext\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmsub\u003e\u003cmtext\u003eMSE\u003c/mtext\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eL = \\text{MSE}_c + \\text{MSE}_n\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eL\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eMSE\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eMSE\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"5","key":"hZJ4p10DEy"},{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"We initialize the weights using the original household weights from the survey data:","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"HSwQJUxF4I"}],"key":"E29KYtEw3e"},{"type":"math","value":"w_{\\text{initial}} = \\ln(\\text{household}_{weight}/650)","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmtext\u003einitial\u003c/mtext\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmi\u003eln\u003c/mi\u003e\u003cmo\u003e⁡\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmtext\u003ehousehold\u003c/mtext\u003e\u003cmrow\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003eg\u003c/mi\u003e\u003cmi\u003eh\u003c/mi\u003e\u003cmi\u003et\u003c/mi\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmi mathvariant=\"normal\"\u003e/\u003c/mi\u003e\u003cmn\u003e650\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ew_{\\text{initial}} = \\ln(\\text{household}_{weight}/650)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord text mtight\"\u003e\u003cspan class=\"mord mtight\"\u003einitial\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop\"\u003eln\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003ehousehold\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3361em;\"\u003e\u003cspan style=\"top:-2.55em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ee\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ei\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\"\u003eg\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003eh\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight\"\u003et\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2861em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e/650\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"6","key":"rmIlQg5wwS"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"where 650 is the number of constituencies. These weights are then iteratively optimized using the Adam (Adaptive Moment Estimation) optimizer with a learning rate of 0.1. The optimization process runs for 512 epochs, with the weights being updated in each iteration:","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"pw3yudKinX"}],"key":"qNQxHy032p"},{"type":"math","value":"w_{t+1} = w_t - 0.1 \\times \\nabla L(w_t)","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"html":"\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmi\u003et\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e0.1\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmi mathvariant=\"normal\"\u003e∇\u003c/mi\u003e\u003cmi\u003eL\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmi\u003et\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ew_{t+1} = w_t - 0.1 \\times \\nabla L(w_t)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003et\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2806em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003et\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e0.1\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e∇\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eL\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2806em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003et\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","enumerator":"7","key":"FFkFWcrj82"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"This formulation ensures that the optimized weights maintain both local consistency at the constituency level and global accuracy for national-level statistics. The Adam optimizer adaptively adjusts the weights to minimize both constituency-level and national-level errors simultaneously, providing efficient convergence through adaptive learning rates and momentum. The resulting optimized weights allow us to accurately reweight household survey data to match both constituency-level and national statistics to obtain accurate estimates of income distributions, demographics, and policy impacts for each parliamentary constituency while maintaining consistency with national totals.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"w4EViHKKlb"}],"key":"Fq9Rez6fq1"}],"key":"AG58r1f4zo"},{"type":"block","kind":"notebook-content","children":[{"type":"comment","value":" ![](pictures/parliamentary_earnings.png) ","key":"UMvsLlrG8l"}],"key":"M2SCShnXnO"}],"key":"FIyiaYmxSZ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Pension contributions","url":"/pension-contributions","group":"PolicyEngine UK data"},"next":{"title":"Local authority methodology","url":"/la-methodology","group":"PolicyEngine UK data"}}},"domain":"http://localhost:3000"},"project":{"title":"PolicyEngine UK data","authors":[{"nameParsed":{"given":"PolicyEngine","family":"Team","literal":"PolicyEngine Team"},"name":"PolicyEngine Team","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/policyengine/policyengine-uk-data","copyright":"2024","toc":[{"file":"intro.md"},{"file":"methodology.ipynb"},{"file":"imputations.md"},{"children":[{"file":"validation/national.ipynb"},{"file":"validation/constituencies.ipynb"},{"file":"validation/local_authorities.ipynb"}],"file":"validation/index.md"},{"file":"pension_contributions.ipynb"},{"file":"constituency_methodology.ipynb"},{"file":"LA_methodology.ipynb"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"methodology","title":"Methodology","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"imputations","title":"Imputations","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"validation.index","title":"Validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"validation.national","title":"National dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"validation.constituencies","title":"Constituency dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"validation.local-authorities","title":"Local authority dataset validation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"pension-contributions","title":"Pension contributions","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"constituency-methodology","title":"Constituency methodology","description":"","date":"","thumbnail":"/policyengine-uk-data/build/nomis_screenshot1-9564622aa17f6683cd4182d79cd16b4c.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"la-methodology","title":"Local authority methodology","description":"","date":"","thumbnail":"/policyengine-uk-data/build/nomis_screenshot2-87ccebeb16251bd114856327df9b29f7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/policyengine-uk-data/build/manifest-51D9907C.js";
import * as route0 from "/policyengine-uk-data/build/root-TRTRBUUN.js";
import * as route1 from "/policyengine-uk-data/build/routes/$-VLPGWU3Z.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/policyengine-uk-data/build/entry.client-PCJPW7TK.js");</script></body></html>